<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AgroTech — MVP v2 (Wheat, SKO)</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css"
    />
    <link rel="stylesheet" href="style.css">

    
  </head>
  <body>
    <div id="app" class="app">
      <aside class="sidebar card">
        <div class="brand">AgroTech — MVP v2</div>
        <div class="small">Роль: <strong id="roleLabel">гость</strong></div>
        <div style="height: 12px"></div>
        <div class="nav" role="navigation">
          <button data-view="dashboard" class="active">Панель</button>
          <button data-view="tasks">Задачи</button>
          <button data-view="news">Стена новостей</button>
          <button data-view="chat">Чат</button>
          <button data-view="weather">Погода</button>
          <button data-view="alerts">Сигналы</button>
          <button data-view="admin" id="adminBtn" style="display: none">
            Модерация фото
          </button>
        </div>
        <div style="flex: 1"></div>
        <div style="margin-top: 14px">
          <button id="loginBtn" class="btn">Войти</button>
          <button id="logoutBtn" class="btn secondary hidden">Выйти</button>
        </div>
      </aside>
      <main class="content">
        <div class="header">
          <h2 id="pageTitle">Панель</h2>
          <div class="small">
            Демо MVP — прогноз для <strong>пшеницы (СКО, Петропавловск)</strong>
          </div>
        </div>

        <section id="dashboard" class="view">
          <div class="grid">
            <div class="card">
              <h3>Мониторинг полей и животных</h3>
              <p class="small">Быстрые индикаторы состояния</p>
              <div style="display: flex; gap: 8px; margin-top: 8px">
                <div class="card" style="flex: 1; text-align: center">
                  <div class="tag">Влажность (условно)</div>
                  <div style="font-size: 24px; margin-top: 6px" id="soilHum">
                    --%
                  </div>
                </div>
                <div class="card" style="flex: 1; text-align: center">
                  <div class="tag">Удобрения</div>
                  <div style="font-size: 24px; margin-top: 6px" id="fert">
                    --%
                  </div>
                </div>
                <div class="card" style="flex: 1; text-align: center">
                  <div class="tag">Животные (здоровье)</div>
                  <div style="font-size: 24px; margin-top: 6px" id="livestock">
                    --%
                  </div>
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Быстрые действия</h3>
              <div
                style="
                  display: flex;
                  flex-direction: column;
                  gap: 8px;
                  margin-top: 8px;
                "
              >
                <button class="btn" id="newTaskBtn">Добавить задачу</button>
                <button class="btn secondary" id="openNewsBtn">
                  Опубликовать новость
                </button>
                <button class="btn" id="openChatBtn">Открыть чат</button>
              </div>
            </div>

            <div class="card">
              <h3>Прогноз риска</h3>
              <p class="small">
                Считается на основе данных погоды (Open-Meteo)
              </p>
              <div style="font-size: 36px; margin-top: 8px" id="riskScore">
                --%
              </div>
              <div style="margin-top: 8px" id="riskTextWrap"></div>
            </div>
          </div>

          <div style="display: flex; gap: 12px; margin-top: 12px">
            <div class="card" style="flex: 1">
              <h3>Карта (демо)</h3>
              <div
                style="
                  height: 200px;
                  border-radius: 8px;
                  background: linear-gradient(180deg, #e6f7eb, #f7fff9);
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  color: var(--muted);
                "
              >
                Карта полей (placeholder)
              </div>
            </div>

            <div class="card" style="width: 360px">
              <h3>Аналитика</h3>
              <div id="chartWrap" style="height: 200px">(график демо)</div>
            </div>
          </div>
        </section>

        <section id="tasks" class="view hidden">
          <div class="card">
            <h3>Task Manager</h3>
            <p class="small">
              Задачи сгруппированы по типу риска. Только
              <strong>старший сотрудник</strong> может создавать новые задачи.
            </p>
            <div style="display: flex; gap: 8px; margin-top: 8px">
              <select id="groupFilter">
                <option value="all">Все группы</option>
              </select>
              <button id="addTaskBtn" class="btn">Новая задача</button>
            </div>
            <div style="display: flex; gap: 12px; margin-top: 12px">
              <div style="flex: 1">
                <h4>Список задач</h4>
                <div id="taskGroups" class="task-list"></div>
              </div>
              <div style="width: 320px">
                <h4>Детали / Создать</h4>
                <div id="taskForm" class="card">
                  <label
                    >Название<br /><input id="taskName" style="width: 100%"
                  /></label>
                  <label
                    >Группа риска<br /><input
                      id="taskGroup"
                      placeholder="влажность, удобрения, животные"
                      style="width: 100%"
                  /></label>
                  <label
                    >Описание<br /><textarea
                      id="taskDesc"
                      style="width: 100%"
                    ></textarea>
                  </label>
                  <div style="display: flex; gap: 8px; margin-top: 8px">
                    <button id="saveTaskBtn" class="btn">Сохранить</button>
                    <button id="clearTaskBtn" class="btn secondary">
                      Очистить
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section id="news" class="view hidden">
          <div class="card">
            <h3>Стена новостей и обсуждений</h3>
            <div style="display: flex; gap: 8px; margin-top: 8px">
              <input
                id="newsTitle"
                placeholder="Заголовок"
                style="flex: 1"
              /><button id="postNewsBtn" class="btn">Опубликовать</button>
            </div>
            <div id="newsWall" style="margin-top: 12px"></div>
          </div>
        </section>

        <section id="chat" class="view hidden">
          <div class="card chat">
            <h3>Чат</h3>
            <div class="messages" id="messages"></div>
            <div style="display: flex; gap: 8px; margin-top: 8px">
              <input id="msgInput" style="flex: 1" /><button
                id="sendMsgBtn"
                class="btn"
              >
                Отправить
              </button>
            </div>
          </div>
        </section>

        <section id="weather" class="view hidden">
          <div class="card">
            <h3>Прогноз погоды</h3>
            <p class="small">
              Демо-панель: используется Open-Meteo для получения температуры и
              осадков
            </p>
            <div style="display: flex; gap: 12px; align-items: center">
              <input
                id="cityInput"
                placeholder="Казахстан, Петропавловск"
                style="flex: 1"
              /><button id="getWeatherBtn" class="btn">Получить</button>
            </div>
            <div id="weatherRes" style="margin-top: 12px"></div>
          </div>
        </section>

        <section id="alerts" class="view hidden">
          <div class="card">
            <h3>Экстренные сообщения</h3>
            <div id="alertsList"></div>
          </div>
        </section>

        <section id="admin" class="view hidden">
          <div class="card">
            <h3>Модерация фото (только для роли: старший)</h3>
            <div id="photoModeration"></div>
          </div>
        </section>

        <footer>
          Демо-версия — данные хранятся в браузере (localStorage). Роли:
          <strong>farmer1/pass</strong>, <strong>agro1/pass</strong>,
          <strong>senior/pass</strong>.
        </footer>
      </main>
    </div>

    <!-- Login modal -->
    <div
      id="loginModal"
      class="card hidden"
      style="
        position: fixed;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        width: 360px;
        z-index: 30;
      "
    >
      <h3>Авторизация</h3>
      <label>Логин<br /><input id="loginUser" style="width: 100%" /></label>
      <label
        >Пароль<br /><input id="loginPass" type="password" style="width: 100%"
      /></label>
      <label
        >Роль<br /><select id="roleSelect">
          <option value="farmer">Фермер</option>
          <option value="agronomist">Агроном</option>
          <option value="consultant">Консультант</option>
          <option value="senior">Старший сотрудник</option>
        </select></label
      >
      <div style="display: flex; gap: 8px; margin-top: 8px">
        <button id="doLogin" class="btn">Войти</button
        ><button id="cancelLogin" class="btn secondary">Отмена</button>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
